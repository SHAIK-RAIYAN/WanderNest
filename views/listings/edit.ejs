<% layout('layouts/boilerplate') %>

<body id="internalPage" data-page="edit">
  <div class="container my-5">
    <div class="row justify-content-center">
      <div class="col-12 col-md-11 col-lg-9 col-xl-8">
        <% if (error && error.length > 0) { %>
        <div class="alert-wrapper container mt-4">
          <div
            class="alert alert-danger alert-dismissible fade show"
            role="alert">
            <%= error[0] %>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="alert"
              aria-label="Close"
              onclick="this.closest('.alert-wrapper').remove()"></button>
          </div>
        </div>
        <% } %>
        
        <!-- Card-like Form Box -->
        <div class="border border-secondary-subtle rounded p-4">
          <h1 class="mb-4">Edit Stay Details</h1>
          <form
            action="/listings/<%= listing._id %>?_method=PUT"
            method="POST"
            class="needs-validation"
            enctype="multipart/form-data"
            novalidate>
            <!-- Title -->
            <div class="mb-3">
              <label for="title" class="form-label">Stay Name:</label>
              <input
                type="text"
                id="title"
                name="listing[title]"
                class="form-control"
                value="<%= listing.title %>"
                required />
              <div class="invalid-feedback">Please enter a stay name.</div>
            </div>

            <!-- Description -->
            <div class="mb-3">
              <label for="description" class="form-label">Description:</label>
              <textarea
                id="description"
                name="listing[description]"
                rows="4"
                class="form-control"
                required>
<%= listing.description %></textarea
              >
              <div class="invalid-feedback">Please enter a description for the stay.</div>
            </div>

            <!-- Price + Country on same row -->
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="price" class="form-label">Price per Night (â‚¹):</label>
                <input
                  type="number"
                  id="price"
                  name="listing[price]"
                  class="form-control"
                  value="<%= listing.price %>"
                  required />
                <div class="invalid-feedback">Please enter a Price.</div>
              </div>
              <div class="mb-3">
                <label for="country" class="form-label">Country:</label>
                <select
                  id="country"
                  name="listing[country]"
                  class="form-select"
                  required
                  data-selected-country="<%= listing.country %>">
                  <!-- Options will be populated via JS -->
                </select>
                <div class="invalid-feedback">Please select a Country.</div>
              </div>
            </div>

            <!-- Current Image Preview -->
            <div class="mb-3">
              <label class="form-label">Current Cover Image:</label><br />
              <img
                src="<%= listing.image.url %>"
                alt="Current Image"
                class="img-fluid rounded"
                width="200" />
            </div>

            <!-- Upload New Image -->
            <div class="mb-3">
              <label for="image" class="form-label"
                >Change Cover Image :</label
              >
              <input
                type="file"
                id="image"
                name="image"
                class="form-control"
                accept="image/*" />
              <div class="form-text">Leave blank to keep your current image.</div>
            </div>

            <!-- Location -->
            <div class="mb-3">
              <label for="location" class="form-label">City or Address:</label>
              <input
                type="text"
                id="location"
                name="listing[location]"
                class="form-control"
                value="<%= listing.location %>"
                required />
              <div class="invalid-feedback">Please enter a Location.</div>
            </div>

            <!-- Submit Button -->
            <div class="d-grid">
              <button type="submit" class="btn btn-dark fw-bold">
                Save Changes
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</body>
